<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã©ã†ã¶ã¤ã‚¿ãƒ¯ãƒ¼ãƒãƒˆãƒ«</title>
<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: #eef;
  overflow: hidden;
}

/* ===== ç”»é¢å…±é€š ===== */
.screen {
  position: fixed;
  inset: 0;
  background: rgba(238,238,255,0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.hidden { display: none; }

h1 {
  font-size: 36px;
  margin-bottom: 20px;
}

button {
  font-size: 20px;
  padding: 10px 24px;
  cursor: pointer;
}

/* ===== UI ===== */
#ui {
  position: fixed;
  top: 8px;
  width: 100%;
  text-align: center;
  z-index: 5;
  font-size: 18px;
}
#timer { font-size: 26px; font-weight: bold; }
#eventText { height: 20px; }

/* ===== Canvasã‚’èƒŒé¢ã« ===== */
canvas {
  display: block;
}
</style>
</head>
<body>

<!-- ===== ã‚¿ã‚¤ãƒˆãƒ« ===== -->
<div id="titleScreen" class="screen">
  <h1>ğŸ¾ ã©ã†ã¶ã¤ã‚¿ãƒ¯ãƒ¼ãƒãƒˆãƒ«</h1>
  <button onclick="startGame()">â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- ===== ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ ===== -->
<div id="gameOverScreen" class="screen hidden">
  <h1>ğŸ’¥ ããšã‚ŒãŸï¼</h1>
  <p>ã‚¹ã‚³ã‚¢ï¼š<span id="finalScore"></span></p>
  <button onclick="restart()">ğŸ” ã‚‚ã†ä¸€å›</button>
</div>

<!-- ===== UI ===== -->
<div id="ui" class="hidden">
  â± <span id="timer">5.0</span>ã€€
  ã‚¹ã‚³ã‚¢: <span id="score">0</span>
  <div id="eventText"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
const { Engine, Render, Runner, World, Bodies, Body, Events } = Matter;

/* ================= çŠ¶æ…‹ ================= */
let engine, render, runner;
let current = null;
let score = 0;
let gameActive = false;
let dropStartTime = 0;
let outTimer = null;

const DROP_LIMIT = 5000;

/* ================= åˆæœŸåŒ– ================= */
function initMatter() {
  engine = Engine.create();
  engine.gravity.y = 1;

  render = Render.create({
    element: document.body,
    engine,
    options: {
      width: 400,
      height: 600,
      wireframes: false,
      background: "#fff"
    }
  });

  runner = Runner.create();
  Runner.run(runner, engine);
  Render.run(render);

  // åœŸå°ï¼ˆè½ã¡ã‚‹ï¼‰
  World.add(engine.world,
    Bodies.rectangle(200, 585, 160, 20, {
      isStatic: true,
      friction: 0.6
    })
  );

  setupEvents();
}

/* ================= å‹•ç‰© ================= */
const animals = [
  { emoji:"ğŸ˜", w:90, density:0.006, friction:0.8 },
  { emoji:"ğŸ§", w:60, density:0.002, friction:0.02 },
  { emoji:"ğŸ°", w:50, density:0.001, restitution:0.9 },
  { emoji:"ğŸ", w:70, density:0.0015, friction:0.1 }
];

/* ================= ã‚¹ãƒãƒ¼ãƒ³ ================= */
function spawnAnimal() {
  if (!gameActive) return;

  const a = animals[Math.floor(Math.random()*animals.length)];
  current = Bodies.rectangle(200, 120, a.w, 40, {
    density: a.density,
    friction: a.friction || 0.4,
    restitution: a.restitution || 0.05,
    render: { text: a.emoji }
  });

  World.add(engine.world, current);
  dropStartTime = Date.now();
}

/* ================= æ“ä½œ ================= */
document.addEventListener("keydown", e => {
  if (!current || !gameActive) return;
  if (e.key === "ArrowLeft") Body.translate(current,{x:-10,y:0});
  if (e.key === "ArrowRight") Body.translate(current,{x:10,y:0});
  if (e.key === " ") drop();
});
document.addEventListener("click", ()=>gameActive && drop());

function drop() {
  if (!current) return;
  current = null;
  score++;
  document.getElementById("score").textContent = score;
  setTimeout(spawnAnimal, 600);
}

/* ================= åˆ¤å®š ================= */
function setupEvents() {

  // ã‚¿ã‚¤ãƒãƒ¼
  Events.on(engine,"beforeUpdate",()=>{
    if (!current || !gameActive) return;
    const r = Math.max(0, DROP_LIMIT - (Date.now()-dropStartTime));
    document.getElementById("timer").textContent = (r/1000).toFixed(1);
    if (r === 0) drop();
  });

  // å ´å¤– â†’ çŒ¶äºˆ â†’ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
  Events.on(engine,"afterUpdate",()=>{
    if (!gameActive) return;
    engine.world.bodies.forEach(b=>{
      if (b.isStatic) return;
      const out = b.position.x < 120 || b.position.x > 280;
      if (out && !outTimer) {
        outTimer = setTimeout(gameOver, 2000);
      }
      if (!out && outTimer) {
        clearTimeout(outTimer);
        outTimer = null;
      }
    });
  });

  // çµµæ–‡å­—æç”»
  Events.on(render,"afterRender",()=>{
    const ctx = render.context;
    ctx.font="32px serif";
    ctx.textAlign="center";
    ctx.textBaseline="middle";

    engine.world.bodies.forEach(b=>{
      if (!b.render.text) return;
      ctx.lineWidth=4;
      ctx.strokeStyle="#000";
      ctx.strokeText(b.render.text,b.position.x,b.position.y);
      ctx.fillStyle="#fff";
      ctx.fillText(b.render.text,b.position.x,b.position.y);
    });
  });
}

/* ================= ç”»é¢åˆ¶å¾¡ ================= */
function startGame() {
  document.getElementById("titleScreen").classList.add("hidden");
  document.getElementById("ui").classList.remove("hidden");

  initMatter();
  score = 0;
  document.getElementById("score").textContent = score;
  gameActive = true;
  spawnAnimal();
}

function gameOver() {
  gameActive = false;
  document.getElementById("finalScore").textContent = score;
  document.getElementById("gameOverScreen").classList.remove("hidden");
}

function restart() {
  location.reload();
}
</script>
</body>
</html>
