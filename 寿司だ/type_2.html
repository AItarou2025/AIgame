<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å¯¿å¸æ‰“ã£ã½ã„ã‚¿ã‚¤ãƒ”ãƒ³ã‚°</title>
<style>
body {
  margin: 0;
  font-family: sans-serif;
  background: linear-gradient(#001, #112);
  color: white;
  text-align: center;
}

h1 { margin-top: 20px; }

#menu, #game, #result {
  display: none;
}

button {
  font-size: 18px;
  padding: 10px 20px;
  margin: 10px;
  cursor: pointer;
}

#lane {
  position: relative;
  overflow: hidden;
  height: 120px;
  background: #222;
  border-top: 4px solid #444;
  border-bottom: 4px solid #444;
  margin: 20px;
}

.sushi {
  position: absolute;
  right: -200px;
  top: 30px;
  font-size: 32px;
  white-space: nowrap;
}

#word {
  font-size: 36px;
  letter-spacing: 4px;
}

.typed {
  color: #4caf50;
}

#info {
  font-size: 18px;
}
</style>
</head>
<body>

<h1>ğŸ£ å¯¿å¸æ‰“ã£ã½ã„ã‚¿ã‚¤ãƒ”ãƒ³ã‚° ğŸ£</h1>

<div id="menu">
  <h2>ã‚³ãƒ¼ã‚¹é¸æŠ</h2>
  <button onclick="start(3000,60)">3000å††ã‚³ãƒ¼ã‚¹</button>
  <button onclick="start(5000,60)">5000å††ã‚³ãƒ¼ã‚¹</button>
  <button onclick="start(10000,90)">10000å††ã‚³ãƒ¼ã‚¹</button>
</div>

<div id="game">
  <div id="info">
    â± <span id="time"></span>ç§’ã€€
    ğŸ’° <span id="money"></span>å††
  </div>

  <div id="lane"></div>
  <div id="word"></div>
</div>

<div id="result">
  <h2>çµæœ</h2>
  <p>ç²å¾—é‡‘é¡ï¼š<span id="resultMoney"></span> å††</p>
  <p>ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼š<span id="high"></span> å††</p>
  <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦</button>
</div>

<script>
const words = [
  {jp:"ã¾ãã‚", roma:"maguro", price:300},
  {jp:"ã‚µãƒ¼ãƒ¢ãƒ³", roma:"salmon", price:300},
  {jp:"ã„ãã‚‰", roma:"ikura", price:400},
  {jp:"ãˆã³", roma:"ebi", price:200},
  {jp:"ã†ãªã", roma:"unagi", price:500},
  {jp:"ãŸã¾ã”", roma:"tamago", price:200},
  {jp:"ã­ãã¨ã‚", roma:"negitoro", price:400},
];

let current;
let index = 0;
let money = 0;
let time = 0;
let timer;
let playing = false;

// éŸ³
const audio = new AudioContext();
function beep(freq=400, len=0.05){
  const o = audio.createOscillator();
  const g = audio.createGain();
  o.frequency.value = freq;
  o.connect(g);
  g.connect(audio.destination);
  o.start();
  g.gain.exponentialRampToValueAtTime(0.0001, audio.currentTime + len);
}

const wordDiv = document.getElementById("word");
const lane = document.getElementById("lane");

function randomWord(){
  current = words[Math.floor(Math.random()*words.length)];
  index = 0;
  renderWord();
  spawnSushi();
}

function renderWord(){
  let html = current.jp + "ï¼ˆ";
  for(let i=0;i<current.roma.length;i++){
    html += i<index ? `<span class="typed">${current.roma[i]}</span>` : current.roma[i];
  }
  html += "ï¼‰";
  wordDiv.innerHTML = html;
}

function spawnSushi(){
  const s = document.createElement("div");
  s.className = "sushi";
  s.textContent = "ğŸ£ " + current.jp;
  lane.appendChild(s);

  let x = -200;
  const move = setInterval(()=>{
    x += 2;
    s.style.right = x + "px";
    if(x > window.innerWidth){
      clearInterval(move);
      s.remove();
    }
  },16);
}

document.addEventListener("keydown", e=>{
  if(!playing) return;
  if(e.key === current.roma[index]){
    beep(600);
    index++;
    renderWord();
    if(index === current.roma.length){
      beep(900,0.1);
      money += current.price;
      randomWord();
    }
  } else {
    beep(200);
  }
});

function start(target, t){
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";

  money = 0;
  time = t;
  playing = true;
  document.getElementById("money").textContent = money;
  document.getElementById("time").textContent = time;

  randomWord();

  timer = setInterval(()=>{
    time--;
    document.getElementById("time").textContent = time;
    document.getElementById("money").textContent = money;

    if(time<=0){
      clearInterval(timer);
      endGame();
    }
  },1000);
}

function endGame(){
  playing = false;
  document.getElementById("game").style.display="none";
  document.getElementById("result").style.display="block";

  document.getElementById("resultMoney").textContent = money;

  const high = Math.max(money, localStorage.getItem("sushi_high")||0);
  localStorage.setItem("sushi_high", high);
  document.getElementById("high").textContent = high;
}

document.getElementById("menu").style.display="block";
</script>

</body>
</html>
