<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒŠãƒ³ãƒ—ãƒ¬ï¼ˆæ•°ç‹¬ï¼‰ã‚²ãƒ¼ãƒ </title>
<style>
body {
  font-family: sans-serif;
  background: #f4f4f4;
  text-align: center;
}

table {
  border-collapse: collapse;
  margin: 20px auto;
}

td {
  width: 45px;
  height: 45px;
  border: 1px solid #555;
  text-align: center;
  vertical-align: middle;
}

input {
  width: 100%;
  height: 100%;
  text-align: center;
  font-size: 20px;
  border: none;
  background: none;
}

input:disabled {
  background: #ddd;
  font-weight: bold;
}

td:nth-child(3), td:nth-child(6) {
  border-right: 3px solid black;
}

tr:nth-child(3) td, tr:nth-child(6) td {
  border-bottom: 3px solid black;
}

.wrong {
  color: red;
}

button {
  font-size: 16px;
  padding: 10px 20px;
}
</style>
</head>
<body>

<h1>ãƒŠãƒ³ãƒ—ãƒ¬ï¼ˆæ•°ç‹¬ï¼‰</h1>

<table id="board"></table>

<button onclick="startGame()">ãƒªã‚»ãƒƒãƒˆ</button>

<script>
let solution = [];
let puzzle = [];

function startGame() {
  solution = generateSudoku();
  puzzle = removeNumbers(solution, 45);
  drawBoard();
}

function drawBoard() {
  const table = document.getElementById("board");
  table.innerHTML = "";

  for (let r = 0; r < 9; r++) {
    const tr = document.createElement("tr");
    for (let c = 0; c < 9; c++) {
      const td = document.createElement("td");
      const input = document.createElement("input");

      if (puzzle[r][c] !== 0) {
        input.value = puzzle[r][c];
        input.disabled = true;
      } else {
        input.addEventListener("input", () => checkInput(input, r, c));
      }

      td.appendChild(input);
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
}

function checkInput(input, r, c) {
  const val = parseInt(input.value);
  if (val === solution[r][c]) {
    input.classList.remove("wrong");
    input.disabled = true;
    checkClear();
  } else {
    input.classList.add("wrong");
  }
}

function checkClear() {
  const inputs = document.querySelectorAll("input");
  for (let i of inputs) {
    if (!i.disabled) return;
  }
  alert("ðŸŽ‰ ã‚¯ãƒªã‚¢ï¼");
}

function generateSudoku() {
  const grid = Array.from({ length: 9 }, () => Array(9).fill(0));
  solve(grid);
  return grid;
}

function solve(grid) {
  for (let r = 0; r < 9; r++) {
    for (let c = 0; c < 9; c++) {
      if (grid[r][c] === 0) {
        const nums = shuffle([1,2,3,4,5,6,7,8,9]);
        for (let n of nums) {
          if (isSafe(grid, r, c, n)) {
            grid[r][c] = n;
            if (solve(grid)) return true;
            grid[r][c] = 0;
          }
        }
        return false;
      }
    }
  }
  return true;
}

function isSafe(grid, r, c, n) {
  for (let i = 0; i < 9; i++) {
    if (grid[r][i] === n || grid[i][c] === n) return false;
  }
  const br = Math.floor(r / 3) * 3;
  const bc = Math.floor(c / 3) * 3;
  for (let i = br; i < br + 3; i++) {
    for (let j = bc; j < bc + 3; j++) {
      if (grid[i][j] === n) return false;
    }
  }
  return true;
}

function removeNumbers(grid, count) {
  const puzzle = grid.map(r => r.slice());
  let removed = 0;
  while (removed < count) {
    const r = Math.floor(Math.random() * 9);
    const c = Math.floor(Math.random() * 9);
    if (puzzle[r][c] !== 0) {
      puzzle[r][c] = 0;
      removed++;
    }
  }
  return puzzle;
}

function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

startGame();
</script>

</body>
</html>
