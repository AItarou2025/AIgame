<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>落ちてくるブロック回避ゲーム</title>
<style>
body{
  margin:0;
  background:#0f1724;
  color:#e6eef8;
  font-family:system-ui;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
#wrap{text-align:center}
canvas{background:#061226;border:2px solid #1e293b;border-radius:8px}
#info{margin-top:10px;font-size:18px}
#title{
  position:fixed;inset:0;background:rgba(0,0,0,0.85);
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  z-index:10
}
button{
  margin-top:20px;
  font-size:22px;
  padding:10px 26px;
  border-radius:12px;
  border:2px solid #60a5fa;
  background:#0b1220;
  color:#fff;
  cursor:pointer
}
button:hover{transform:translateY(-2px)}
</style>
</head>
<body>

<div id="title">
  <h1>落ちてくるブロック回避ゲーム</h1>
  <p>← → キーで移動</p>
  <button id="start">ゲームスタート</button>
</div>

<div id="wrap">
  <canvas id="c" width="400" height="600"></canvas>
  <div id="info">スコア: <span id="score">0</span></div>
</div>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const title = document.getElementById('title');
  const startBtn = document.getElementById('start');

  const W = canvas.width, H = canvas.height;

  let player, blocks, score, speed, playing;

  function init(){
    player = { x: W/2-20, y: H-50, w:40, h:20, speed:6 };
    blocks = [];
    score = 0;
    speed = 2;
    playing = true;
    scoreEl.textContent = score;
    loop();
  }

  function spawnBlock(){
    const size = 30 + Math.random()*20;
    blocks.push({
      x: Math.random()*(W-size),
      y: -size,
      w: size,
      h: size,
      v: speed + Math.random()*2
    });
  }

  function update(){
    if(Math.random()<0.03) spawnBlock();

    for(const b of blocks){
      b.y += b.v;
      // 衝突判定
      if(b.x < player.x+player.w && b.x+b.w > player.x &&
         b.y < player.y+player.h && b.y+b.h > player.y){
        gameOver();
      }
    }

    blocks = blocks.filter(b => b.y < H+50);
    score++;
    scoreEl.textContent = score;

    if(score % 300 === 0) speed += 0.5;
  }

  function draw(){
    ctx.clearRect(0,0,W,H);
    // プレイヤー
    ctx.fillStyle = '#f97316';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    // ブロック
    ctx.fillStyle = '#60a5fa';
    for(const b of blocks){ ctx.fillRect(b.x,b.y,b.w,b.h); }
  }

  function loop(){
    if(!playing) return;
    update();
    draw();
    requestAnimationFrame(loop);
  }

  function gameOver(){
    playing = false;
    title.innerHTML = `<h1>ゲームオーバー</h1><p>スコア: ${score}</p><button id="restart">もう一度</button>`;
    title.style.display = 'flex';
    document.getElementById('restart').onclick = () => {
      title.style.display = 'none';
      init();
    };
  }

  // 操作
  window.addEventListener('keydown', e => {
    if(!playing) return;
    if(e.key==='ArrowLeft') player.x = Math.max(0, player.x-player.speed);
    if(e.key==='ArrowRight') player.x = Math.min(W-player.w, player.x+player.speed);
  });

  startBtn.onclick = () => {
    title.style.display = 'none';
    init();
  };
})();
</script>

</body>
</html>
