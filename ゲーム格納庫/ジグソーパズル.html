<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>„Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´</title>
<style>
body {
  font-family: sans-serif;
  background: #f0f0f0;
  text-align: center;
}

#game {
  display: flex;
  justify-content: center;
  gap: 40px;
  margin-top: 20px;
}

#board {
  position: relative;
  width: 300px;
  height: 300px;
  border: 3px solid #333;
  background: #ccc;
}

.slot {
  position: absolute;
  width: 100px;
  height: 100px;
  border: 1px dashed #999;
  box-sizing: border-box;
}

.piece {
  width: 100px;
  height: 100px;
  background-image: url("https://picsum.photos/300");
  background-size: 300px 300px;
  cursor: grab;
}

#pieces {
  width: 320px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}
</style>
</head>
<body>

<h1>„Ç∏„Ç∞„ÇΩ„Éº„Éë„Ç∫„É´</h1>

<div id="game">
  <div id="board"></div>
  <div id="pieces"></div>
</div>

<script>
const size = 3;
const imgSize = 300;
const pieceSize = imgSize / size;

const board = document.getElementById("board");
const piecesArea = document.getElementById("pieces");

let correctCount = 0;

// „Çπ„É≠„ÉÉ„Éà‰ΩúÊàê
for (let y = 0; y < size; y++) {
  for (let x = 0; x < size; x++) {
    const slot = document.createElement("div");
    slot.className = "slot";
    slot.style.left = x * pieceSize + "px";
    slot.style.top = y * pieceSize + "px";
    slot.dataset.correct = `${x}-${y}`;

    slot.addEventListener("dragover", e => e.preventDefault());
    slot.addEventListener("drop", dropPiece);

    board.appendChild(slot);
  }
}

// „Éî„Éº„Çπ‰ΩúÊàê
let pieces = [];
for (let y = 0; y < size; y++) {
  for (let x = 0; x < size; x++) {
    const piece = document.createElement("div");
    piece.className = "piece";
    piece.draggable = true;
    piece.dataset.pos = `${x}-${y}`;

    piece.style.backgroundPosition =
      `-${x * pieceSize}px -${y * pieceSize}px`;

    piece.addEventListener("dragstart", e => {
      e.dataTransfer.setData("text/plain", piece.dataset.pos);
    });

    pieces.push(piece);
  }
}

// „Ç∑„É£„ÉÉ„Éï„É´
pieces.sort(() => Math.random() - 0.5);
pieces.forEach(p => piecesArea.appendChild(p));

function dropPiece(e) {
  const pos = e.dataTransfer.getData("text/plain");
  const slotPos = this.dataset.correct;

  if (pos === slotPos && this.children.length === 0) {
    const piece = [...document.querySelectorAll(".piece")]
      .find(p => p.dataset.pos === pos);

    piece.style.position = "absolute";
    piece.style.left = "0px";
    piece.style.top = "0px";
    piece.draggable = false;

    this.appendChild(piece);
    correctCount++;

    if (correctCount === size * size) {
      setTimeout(() => alert("üéâ „ÇØ„É™„Ç¢ÔºÅ"), 100);
    }
  }
}
</script>

</body>
</html>
